#!/usr/bin/env perl

# Create a web page of events from a family tree

use strict;
use warnings;

use utf8;

use open qw(:std :encoding(UTF-8));

use autodie;

use Gedcom;
use HTML::Genealogy::Map;

# Configuration
my $gedcom_file = $ARGV[0] or die "Usage: $0 <gedcom_file>";
my $output_file = $ARGV[1] || 'events_map.html';

# Initialize GEDCOM parser
my $gedcom = Gedcom->new(gedcom_file => $gedcom_file, read_only => 1);

my ($head, $body) = HTML::Genealogy::Map->onload_render({ gedcom => $gedcom, debug => 1, google_key => $ENV{'GMAP_WEBSITE_KEY'} });

if(open(my $fout, '>', $output_file)) {
	print "Saving map to $output_file\n";

	print $fout ${render($head, $body)};

	close $fout;
}

# Generate HTML
sub render {
	my ($head, $body) = @_;

	my $html = <<"HTML";
<!DOCTYPE html>
<html>
<head>
	<title>GEDCOM Events Map</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
		#map {
			margin: 0 auto; /* This centers it horizontally */
			height: 90vh;
			width: 80% !important;
		}
		#map > * {
			margin: 0 auto; /* This centers child elements */
			width: 100% !important; /* Use 100% to fill the parent, not 80% */
			height: 100% !important;
		}
	</style>
	$head
</head>
<body>
	<div id="map">
	$body
	</div>
</body>
</html>
HTML

	return \$html;
}
